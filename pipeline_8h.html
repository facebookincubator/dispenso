<!-- HTML header for generated pages -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dispenso: /github/workspace/dispenso/pipeline.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">dispenso<span id="projectnumber">&#160;1.4.1</span>
   </div>
   <div id="projectbrief">A library for task parallelism</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('pipeline_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">pipeline.h File Reference<div class="ingroups"><a class="el" href="group__group__graph.html">Graphs &amp; Pipelines</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;limits&gt;</code><br />
<code>#include &lt;dispenso/detail/pipeline_impl.h&gt;</code><br />
</div>
<p><a href="pipeline_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ad59b35109942aaa4651f9a8a7ecf8d2a" id="r_ad59b35109942aaa4651f9a8a7ecf8d2a"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ad59b35109942aaa4651f9a8a7ecf8d2a"><td class="memTemplItemLeft" align="right" valign="top">using&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#ad59b35109942aaa4651f9a8a7ecf8d2a">dispenso::OpResult</a> = detail::OpResult&lt;T&gt;</td></tr>
<tr class="memdesc:ad59b35109942aaa4651f9a8a7ecf8d2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Optional-like storage with in-place construction (C++14 compatible).  <br /></td></tr>
<tr class="separator:ad59b35109942aaa4651f9a8a7ecf8d2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a360af299cbfaa8e0069ec014f87d1ddb" id="r_a360af299cbfaa8e0069ec014f87d1ddb"><td class="memTemplParams" colspan="2">template&lt;typename F &gt; </td></tr>
<tr class="memitem:a360af299cbfaa8e0069ec014f87d1ddb"><td class="memTemplItemLeft" align="right" valign="top">auto&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#a360af299cbfaa8e0069ec014f87d1ddb">dispenso::stage</a> (F &amp;&amp;f, ssize_t limit)</td></tr>
<tr class="separator:a360af299cbfaa8e0069ec014f87d1ddb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5438114dce2544c8cdab8100309478ab" id="r_a5438114dce2544c8cdab8100309478ab"><td class="memTemplParams" colspan="2">template&lt;typename... Stages&gt; </td></tr>
<tr class="memitem:a5438114dce2544c8cdab8100309478ab"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#a5438114dce2544c8cdab8100309478ab">dispenso::pipeline</a> (<a class="el" href="classdispenso_1_1_thread_pool.html">ThreadPool</a> &amp;pool, Stages &amp;&amp;... sIn)</td></tr>
<tr class="separator:a5438114dce2544c8cdab8100309478ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9a0289cbbb678c03532bdf458da1401b" id="r_a9a0289cbbb678c03532bdf458da1401b"><td class="memTemplParams" colspan="2">template&lt;typename... Stages&gt; </td></tr>
<tr class="memitem:a9a0289cbbb678c03532bdf458da1401b"><td class="memTemplItemLeft" align="right" valign="top">void&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#a9a0289cbbb678c03532bdf458da1401b">dispenso::pipeline</a> (Stages &amp;&amp;... sIn)</td></tr>
<tr class="separator:a9a0289cbbb678c03532bdf458da1401b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa1d380eb639cdbd92330b96253a68e4a" id="r_aa1d380eb639cdbd92330b96253a68e4a"><td class="memItemLeft" align="right" valign="top">constexpr ssize_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aa1d380eb639cdbd92330b96253a68e4a">dispenso::kStageNoLimit</a> = std::numeric_limits&lt;ssize_t&gt;::max()</td></tr>
<tr class="separator:aa1d380eb639cdbd92330b96253a68e4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A file providing utilities for parallel pipelining of work. </p>

<p class="definition">Definition in file <a class="el" href="pipeline_8h_source.html">pipeline.h</a>.</p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="ad59b35109942aaa4651f9a8a7ecf8d2a" name="ad59b35109942aaa4651f9a8a7ecf8d2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad59b35109942aaa4651f9a8a7ecf8d2a">&#9670;&#160;</a></span>OpResult</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#ad59b35109942aaa4651f9a8a7ecf8d2a">dispenso::OpResult</a> = detail::OpResult&lt;T&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Optional-like storage with in-place construction (C++14 compatible). </p>
<p>OpResult is like a poor-man's std::optional for those who wish to use dispenso pipeline filtering in C++14. In C++17 and beyond, it is recommended to use std::optional instead. OpResult has implicit construct from T, just like std::optional, and move/copy constructors and operators, bool conversion, and value() function, but otherwise provides less functionality than std::optional.</p>
<p>Provides similar functionality to std::optional but works in C++14 codebases. Stores the value in-place and tracks whether a value is present.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>The type to store</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>For small types, this has ~2x the size overhead of std::optional (pointer vs bool flag). For larger types, the overhead is similar. Prefer std::optional in C++17 and later.</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><a class="code hl_typedef" href="#ad59b35109942aaa4651f9a8a7ecf8d2a">dispenso::OpResult&lt;int&gt;</a> result;</div>
<div class="line"><span class="keywordflow">if</span> (success) {</div>
<div class="line">  result.emplace(42);</div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">if</span> (result) {</div>
<div class="line">  use(result.value());</div>
<div class="line">}</div>
<div class="ttc" id="apipeline_8h_html_ad59b35109942aaa4651f9a8a7ecf8d2a"><div class="ttname"><a href="#ad59b35109942aaa4651f9a8a7ecf8d2a">dispenso::OpResult</a></div><div class="ttdeci">detail::OpResult&lt; T &gt; OpResult</div><div class="ttdoc">Optional-like storage with in-place construction (C++14 compatible).</div><div class="ttdef"><b>Definition</b> <a href="pipeline_8h_source.html#l00030">pipeline.h:30</a></div></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="pipeline_8h_source.html#l00030">30</a> of file <a class="el" href="pipeline_8h_source.html">pipeline.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a9a0289cbbb678c03532bdf458da1401b" name="a9a0289cbbb678c03532bdf458da1401b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9a0289cbbb678c03532bdf458da1401b">&#9670;&#160;</a></span>pipeline() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename... Stages&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void dispenso::pipeline </td>
          <td>(</td>
          <td class="paramtype">Stages &amp;&amp;...</td>          <td class="paramname"><span class="paramname"><em>sIn</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pipeline work in stages. Pipelines allow stages to specify parallelism limits by using the <code>stage</code> function, or a function-like object can simply be passed directly, indicating a serial stage. Even if stages are serial, there can be parallelism between stages, so in a 3 stage serial pipeline, the expected runtime is the max of the 3 stages runtimes (note that this is in the absence of pipeline overheads and with an infinitely long workstream. In practice speedup is somewhat less). Work will be run on dispenso's global thread pool. This function will block until the entire pipeline has completed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sIn</td><td>The stages to run. The first stage must be a Generator stage, the last must be a Sink stage, and intermediate stages are Transform stages.<ul>
<li>If there is only one stage, it takes no arguments, but returns a bool indicating completion (false means the pipeline is complete).</li>
<li>Otherwise, the Generator stage takes no arguments and must return an OpResult or std::optional value, and an invalid/nullopt result indicates that the Generator is done (no more values forthcoming).</li>
<li>Transform stages should accept the output of the prior stage (or output.value() in the case of OpResult or std::optional), and should return either a value or an OpResult or std::optional value if the Transform is capable of filtering results. Invalid/nullopt OpResult or std::optional values indicate that the value should be filtered, and not passed on to the next stage.</li>
<li>The Sink stage should accept the output of the prior stage, just as a Transform stage does, but does not return any value (or at least the pipeline will ignore it). </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pipeline_8h_source.html#l00109">109</a> of file <a class="el" href="pipeline_8h_source.html">pipeline.h</a>.</p>

</div>
</div>
<a id="a5438114dce2544c8cdab8100309478ab" name="a5438114dce2544c8cdab8100309478ab"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5438114dce2544c8cdab8100309478ab">&#9670;&#160;</a></span>pipeline() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename... Stages&gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void dispenso::pipeline </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classdispenso_1_1_thread_pool.html">ThreadPool</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>pool</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Stages &amp;&amp;...</td>          <td class="paramname"><span class="paramname"><em>sIn</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Pipeline work in stages. Pipelines allow stages to specify parallelism limits by using the <code>stage</code> function, or a function-like object can simply be passed directly, indicating a serial stage. Even if stages are serial, there can be parallelism between stages, so in a 3 stage serial pipeline, the expected runtime is the max of the 3 stages runtimes (note that this is in the absence of pipeline overheads and with an infinitely long workstream. In practice speedup is somewhat less). This function will block until the entire pipeline has completed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pool</td><td>The ThreadPool to run the work in. This inherently determines the upper bound for parallelism of the pipeline. </td></tr>
    <tr><td class="paramname">sIn</td><td>The stages to run. The first stage must be a Generator stage, the last must be a Sink stage, and intermediate stages are Transform stages.<ul>
<li>If there is only one stage, it takes no arguments, but returns a bool indicating completion (false means the pipeline is complete).</li>
<li>Otherwise, the Generator stage takes no arguments and must return an OpResult or std::optional value, and an invalid/nullopt result indicates that the Generator is done (no more values forthcoming).</li>
<li>Transform stages should accept the output of the prior stage (or output.value() in the case of OpResult or std::optional), and should return either a value or an OpResult or std::optional value if the Transform is capable of filtering results. Invalid/nullopt OpResult or std::optional values indicate that the value should be filtered, and not passed on to the next stage.</li>
<li>The Sink stage should accept the output of the prior stage, just as a Transform stage does, but does not return any value (or at least the pipeline will ignore it). </li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="pipeline_example_8cpp-example.html#a0">pipeline_example.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pipeline_8h_source.html#l00078">78</a> of file <a class="el" href="pipeline_8h_source.html">pipeline.h</a>.</p>

</div>
</div>
<a id="a360af299cbfaa8e0069ec014f87d1ddb" name="a360af299cbfaa8e0069ec014f87d1ddb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a360af299cbfaa8e0069ec014f87d1ddb">&#9670;&#160;</a></span>stage()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename F &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">auto dispenso::stage </td>
          <td>(</td>
          <td class="paramtype">F &amp;&amp;</td>          <td class="paramname"><span class="paramname"><em>f</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t</td>          <td class="paramname"><span class="paramname"><em>limit</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Create a stage for use in the pipeline function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">f</td><td>A function-like object that can accept the result of the previous stage (if any), and which produces the output for the next stage (if any). </td></tr>
    <tr><td class="paramname">limit</td><td>How many threads may concurrently run work for this stage. Values larger than the number of threads in the associated thread pool of the used ConcurrentTaskSet will be capped to the size of the pool. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A stage object suitable for pipelining. </dd></dl>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="pipeline_example_8cpp-example.html#a1">pipeline_example.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pipeline_8h_source.html#l00049">49</a> of file <a class="el" href="pipeline_8h_source.html">pipeline.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="aa1d380eb639cdbd92330b96253a68e4a" name="aa1d380eb639cdbd92330b96253a68e4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1d380eb639cdbd92330b96253a68e4a">&#9670;&#160;</a></span>kStageNoLimit</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ssize_t dispenso::kStageNoLimit = std::numeric_limits&lt;ssize_t&gt;::max()</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>A simple constant representing maximum parallelism for a stage. This number has no particular significance, and is simply here for convenience. </p>
<dl class="section examples"><dt>Examples</dt><dd><a class="el" href="pipeline_example_8cpp-example.html#a3">pipeline_example.cpp</a>.</dd>
</dl>

<p class="definition">Definition at line <a class="el" href="pipeline_8h_source.html#l00036">36</a> of file <a class="el" href="pipeline_8h_source.html">pipeline.h</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_ff109a5d4b8a833924ba8452f0ad7d5d.html">dispenso</a></li><li class="navelem"><a class="el" href="pipeline_8h.html">pipeline.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
