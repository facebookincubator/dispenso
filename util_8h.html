<!-- HTML header for generated pages -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dispenso: /github/workspace/dispenso/util.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">dispenso<span id="projectnumber">&#160;1.4.1</span>
   </div>
   <div id="projectbrief">A library for task parallelism</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('util_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">util.h File Reference<div class="ingroups"><a class="el" href="group__group__util.html">Utilities</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;dispenso/detail/math.h&gt;</code><br />
<code>#include &lt;dispenso/detail/op_result.h&gt;</code><br />
<code>#include &lt;<a class="el" href="platform_8h_source.html">dispenso/platform.h</a>&gt;</code><br />
</div>
<p><a href="util_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a38fa2dd7d6fcde1af0c8902cf34d03e1" id="r_a38fa2dd7d6fcde1af0c8902cf34d03e1"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:a38fa2dd7d6fcde1af0c8902cf34d03e1"><td class="memTemplItemLeft" align="right" valign="top">using&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#a38fa2dd7d6fcde1af0c8902cf34d03e1">dispenso::AlignedDeleter</a> = detail::AlignedFreeDeleter&lt;T&gt;</td></tr>
<tr class="memdesc:a38fa2dd7d6fcde1af0c8902cf34d03e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deleter for smart pointers that use aligned memory allocation.  <br /></td></tr>
<tr class="separator:a38fa2dd7d6fcde1af0c8902cf34d03e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a613170ba10cdb43f7d50a877e573b2ff" id="r_a613170ba10cdb43f7d50a877e573b2ff"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:a613170ba10cdb43f7d50a877e573b2ff"><td class="memTemplItemLeft" align="right" valign="top">using&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#a613170ba10cdb43f7d50a877e573b2ff">dispenso::AlignedBuffer</a> = detail::AlignedBuffer&lt;T&gt;</td></tr>
<tr class="memdesc:a613170ba10cdb43f7d50a877e573b2ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Buffer with proper alignment for type T.  <br /></td></tr>
<tr class="separator:a613170ba10cdb43f7d50a877e573b2ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0acc74f72240faf8477f8b1bf4e57c31" id="r_a0acc74f72240faf8477f8b1bf4e57c31"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:a0acc74f72240faf8477f8b1bf4e57c31"><td class="memTemplItemLeft" align="right" valign="top">using&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="#a0acc74f72240faf8477f8b1bf4e57c31">dispenso::AlignedAtomic</a> = detail::AlignedAtomic&lt;T&gt;</td></tr>
<tr class="memdesc:a0acc74f72240faf8477f8b1bf4e57c31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cache-line aligned atomic pointer.  <br /></td></tr>
<tr class="separator:a0acc74f72240faf8477f8b1bf4e57c31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab2f5761fa05027e51d120a8903637329" id="r_ab2f5761fa05027e51d120a8903637329"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ab2f5761fa05027e51d120a8903637329">dispenso::StaticChunking</a> = detail::StaticChunking</td></tr>
<tr class="memdesc:ab2f5761fa05027e51d120a8903637329"><td class="mdescLeft">&#160;</td><td class="mdescRight">Information for statically chunking a range across threads.  <br /></td></tr>
<tr class="separator:ab2f5761fa05027e51d120a8903637329"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1be7ed751b159ce8e94581884f326fe0" id="r_a1be7ed751b159ce8e94581884f326fe0"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a1be7ed751b159ce8e94581884f326fe0">dispenso::alignedMalloc</a> (size_t bytes, size_t alignment)</td></tr>
<tr class="memdesc:a1be7ed751b159ce8e94581884f326fe0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory with a specified alignment.  <br /></td></tr>
<tr class="separator:a1be7ed751b159ce8e94581884f326fe0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97ee278f83ac281db47fcb6108854c15" id="r_a97ee278f83ac281db47fcb6108854c15"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a97ee278f83ac281db47fcb6108854c15">dispenso::alignedMalloc</a> (size_t bytes)</td></tr>
<tr class="memdesc:a97ee278f83ac281db47fcb6108854c15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate memory aligned to cache line size.  <br /></td></tr>
<tr class="separator:a97ee278f83ac281db47fcb6108854c15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf546b96bdfe2c47cf9a23357c3359df" id="r_adf546b96bdfe2c47cf9a23357c3359df"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#adf546b96bdfe2c47cf9a23357c3359df">dispenso::alignedFree</a> (void *ptr)</td></tr>
<tr class="memdesc:adf546b96bdfe2c47cf9a23357c3359df"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free memory allocated by alignedMalloc.  <br /></td></tr>
<tr class="separator:adf546b96bdfe2c47cf9a23357c3359df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3eaff15957792b4bf4adf0dad3838d42" id="r_a3eaff15957792b4bf4adf0dad3838d42"><td class="memItemLeft" align="right" valign="top">constexpr uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a3eaff15957792b4bf4adf0dad3838d42">dispenso::alignToCacheLine</a> (uintptr_t val)</td></tr>
<tr class="memdesc:a3eaff15957792b4bf4adf0dad3838d42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Align a value up to the next cache line boundary.  <br /></td></tr>
<tr class="separator:a3eaff15957792b4bf4adf0dad3838d42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1e2ca26986584ede0179073a455ab95" id="r_ad1e2ca26986584ede0179073a455ab95"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad1e2ca26986584ede0179073a455ab95">dispenso::cpuRelax</a> ()</td></tr>
<tr class="memdesc:ad1e2ca26986584ede0179073a455ab95"><td class="mdescLeft">&#160;</td><td class="mdescRight">CPU relaxation hint for spin loops.  <br /></td></tr>
<tr class="separator:ad1e2ca26986584ede0179073a455ab95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc7b3cf111878cc7339480bb02b6e801" id="r_afc7b3cf111878cc7339480bb02b6e801"><td class="memItemLeft" align="right" valign="top">constexpr uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afc7b3cf111878cc7339480bb02b6e801">dispenso::nextPow2</a> (uint64_t v)</td></tr>
<tr class="memdesc:afc7b3cf111878cc7339480bb02b6e801"><td class="mdescLeft">&#160;</td><td class="mdescRight">Round up to the next power of 2.  <br /></td></tr>
<tr class="separator:afc7b3cf111878cc7339480bb02b6e801"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af014fb9ca7d4021c6cca0e7fa545dafd" id="r_af014fb9ca7d4021c6cca0e7fa545dafd"><td class="memItemLeft" align="right" valign="top">constexpr uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af014fb9ca7d4021c6cca0e7fa545dafd">dispenso::log2const</a> (uint64_t v)</td></tr>
<tr class="memdesc:af014fb9ca7d4021c6cca0e7fa545dafd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute log base 2 of a value (compile-time).  <br /></td></tr>
<tr class="separator:af014fb9ca7d4021c6cca0e7fa545dafd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af136448e8dfb75d4ffa0a89ef5ae686f" id="r_af136448e8dfb75d4ffa0a89ef5ae686f"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#af136448e8dfb75d4ffa0a89ef5ae686f">dispenso::log2</a> (uint64_t v)</td></tr>
<tr class="memdesc:af136448e8dfb75d4ffa0a89ef5ae686f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute log base 2 of a value (runtime).  <br /></td></tr>
<tr class="separator:af136448e8dfb75d4ffa0a89ef5ae686f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afeee067e0bcb4e306c1ed27fc95b5f21" id="r_afeee067e0bcb4e306c1ed27fc95b5f21"><td class="memItemLeft" align="right" valign="top"><a class="el" href="#ab2f5761fa05027e51d120a8903637329">StaticChunking</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#afeee067e0bcb4e306c1ed27fc95b5f21">dispenso::staticChunkSize</a> (ssize_t items, ssize_t chunks)</td></tr>
<tr class="memdesc:afeee067e0bcb4e306c1ed27fc95b5f21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Compute optimal static chunking for load balancing.  <br /></td></tr>
<tr class="separator:afeee067e0bcb4e306c1ed27fc95b5f21"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A collection of utility functions and types for memory alignment, bit manipulation, and performance optimization.</p>
<dl class="section note"><dt>Note</dt><dd>The constant <code>kCacheLineSize</code> used by several utilities here is defined in <code>&lt;<a class="el" href="platform_8h.html">dispenso/platform.h</a>&gt;</code>, which is included by this header. </dd></dl>

<p class="definition">Definition in file <a class="el" href="util_8h_source.html">util.h</a>.</p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a0acc74f72240faf8477f8b1bf4e57c31" name="a0acc74f72240faf8477f8b1bf4e57c31"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0acc74f72240faf8477f8b1bf4e57c31">&#9670;&#160;</a></span>AlignedAtomic</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#a0acc74f72240faf8477f8b1bf4e57c31">dispenso::AlignedAtomic</a> = detail::AlignedAtomic&lt;T&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Cache-line aligned atomic pointer. </p>
<p>An atomic pointer aligned to cache line boundary to avoid false sharing. Inherits from std::atomic&lt;T*&gt;.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>The pointed-to type</td></tr>
  </table>
  </dd>
</dl>
<p>Example: </p><div class="fragment"><div class="line"><a class="code hl_typedef" href="#a0acc74f72240faf8477f8b1bf4e57c31">dispenso::AlignedAtomic&lt;int&gt;</a> ptr;</div>
<div class="line">ptr.store(<span class="keyword">new</span> <span class="keywordtype">int</span>(42));</div>
<div class="ttc" id="autil_8h_html_a0acc74f72240faf8477f8b1bf4e57c31"><div class="ttname"><a href="#a0acc74f72240faf8477f8b1bf4e57c31">dispenso::AlignedAtomic</a></div><div class="ttdeci">detail::AlignedAtomic&lt; T &gt; AlignedAtomic</div><div class="ttdoc">Cache-line aligned atomic pointer.</div><div class="ttdef"><b>Definition</b> <a href="util_8h_source.html#l00230">util.h:230</a></div></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00230">230</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="a613170ba10cdb43f7d50a877e573b2ff" name="a613170ba10cdb43f7d50a877e573b2ff"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a613170ba10cdb43f7d50a877e573b2ff">&#9670;&#160;</a></span>AlignedBuffer</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#a613170ba10cdb43f7d50a877e573b2ff">dispenso::AlignedBuffer</a> = detail::AlignedBuffer&lt;T&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Buffer with proper alignment for type T. </p>
<p>Provides uninitialized storage with proper alignment for type T. Useful for manual object lifetime management or placement new scenarios.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>The type to provide storage for</td></tr>
  </table>
  </dd>
</dl>
<p>Example: </p><div class="fragment"><div class="line"><a class="code hl_typedef" href="#a613170ba10cdb43f7d50a877e573b2ff">dispenso::AlignedBuffer&lt;MyType&gt;</a> buf;</div>
<div class="line">MyType* obj = <span class="keyword">new</span> (buf.b) MyType();</div>
<div class="line">obj-&gt;~MyType();</div>
<div class="ttc" id="autil_8h_html_a613170ba10cdb43f7d50a877e573b2ff"><div class="ttname"><a href="#a613170ba10cdb43f7d50a877e573b2ff">dispenso::AlignedBuffer</a></div><div class="ttdeci">detail::AlignedBuffer&lt; T &gt; AlignedBuffer</div><div class="ttdoc">Buffer with proper alignment for type T.</div><div class="ttdef"><b>Definition</b> <a href="util_8h_source.html#l00213">util.h:213</a></div></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00213">213</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="a38fa2dd7d6fcde1af0c8902cf34d03e1" name="a38fa2dd7d6fcde1af0c8902cf34d03e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a38fa2dd7d6fcde1af0c8902cf34d03e1">&#9670;&#160;</a></span>AlignedDeleter</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#a38fa2dd7d6fcde1af0c8902cf34d03e1">dispenso::AlignedDeleter</a> = detail::AlignedFreeDeleter&lt;T&gt;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deleter for smart pointers that use aligned memory allocation. </p>
<p>This deleter calls the destructor and frees memory allocated with alignedMalloc. It can be used with std::unique_ptr and std::shared_ptr.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>The type being deleted</td></tr>
  </table>
  </dd>
</dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">using </span>AlignedPtr = std::unique_ptr&lt;MyType, dispenso::AlignedDeleter&lt;MyType&gt;&gt;;</div>
<div class="line"><span class="keywordtype">void</span>* mem = dispenso::alignedMalloc(<span class="keyword">sizeof</span>(MyType), 64);</div>
<div class="line">AlignedPtr ptr(<span class="keyword">new</span> (mem) MyType(), <a class="code hl_typedef" href="#a38fa2dd7d6fcde1af0c8902cf34d03e1">dispenso::AlignedDeleter&lt;MyType&gt;</a>());</div>
<div class="ttc" id="autil_8h_html_a38fa2dd7d6fcde1af0c8902cf34d03e1"><div class="ttname"><a href="#a38fa2dd7d6fcde1af0c8902cf34d03e1">dispenso::AlignedDeleter</a></div><div class="ttdeci">detail::AlignedFreeDeleter&lt; T &gt; AlignedDeleter</div><div class="ttdoc">Deleter for smart pointers that use aligned memory allocation.</div><div class="ttdef"><b>Definition</b> <a href="util_8h_source.html#l00093">util.h:93</a></div></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00093">93</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="ab2f5761fa05027e51d120a8903637329" name="ab2f5761fa05027e51d120a8903637329"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab2f5761fa05027e51d120a8903637329">&#9670;&#160;</a></span>StaticChunking</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="#ab2f5761fa05027e51d120a8903637329">dispenso::StaticChunking</a> = detail::StaticChunking</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Information for statically chunking a range across threads. </p>
<p>When dividing work into static chunks, using a simple chunk size plus remainder can lead to poor load balancing. This struct provides the optimal chunking strategy where some tasks get ceil(items/chunks) work and others get floor(items/chunks). </p>

<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00264">264</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="adf546b96bdfe2c47cf9a23357c3359df" name="adf546b96bdfe2c47cf9a23357c3359df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf546b96bdfe2c47cf9a23357c3359df">&#9670;&#160;</a></span>alignedFree()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dispenso::alignedFree </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>ptr</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Free memory allocated by alignedMalloc. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ptr</td><td>Pointer to memory allocated by alignedMalloc (can be nullptr)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd>alignedMalloc </dd></dl>

<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00073">73</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="a97ee278f83ac281db47fcb6108854c15" name="a97ee278f83ac281db47fcb6108854c15"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97ee278f83ac281db47fcb6108854c15">&#9670;&#160;</a></span>alignedMalloc() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void * dispenso::alignedMalloc </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>bytes</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate memory aligned to cache line size. </p>
<p>This is a convenience overload that aligns to kCacheLineSize (typically 64 bytes), which helps avoid false sharing in concurrent data structures.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bytes</td><td>The number of bytes to allocate </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to cache-line aligned memory, or nullptr on allocation failure</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Memory allocated with alignedMalloc must be freed with alignedFree </dd></dl>
<dl class="section see"><dt>See also</dt><dd>alignedFree, kCacheLineSize </dd></dl>

<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00062">62</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="a1be7ed751b159ce8e94581884f326fe0" name="a1be7ed751b159ce8e94581884f326fe0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1be7ed751b159ce8e94581884f326fe0">&#9670;&#160;</a></span>alignedMalloc() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void * dispenso::alignedMalloc </td>
          <td>(</td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>bytes</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t</td>          <td class="paramname"><span class="paramname"><em>alignment</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Allocate memory with a specified alignment. </p>
<p>This function allocates memory aligned to the specified boundary. The alignment must be a power of 2 and at least sizeof(uintptr_t).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bytes</td><td>The number of bytes to allocate </td></tr>
    <tr><td class="paramname">alignment</td><td>The alignment requirement in bytes (must be power of 2) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Pointer to aligned memory, or nullptr on allocation failure</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Memory allocated with alignedMalloc must be freed with alignedFree </dd></dl>
<dl class="section see"><dt>See also</dt><dd>alignedFree</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span>* ptr = dispenso::alignedMalloc(1024, 64);  <span class="comment">// 64-byte aligned</span></div>
<div class="line"><span class="comment">// ... use ptr ...</span></div>
<div class="line">dispenso::alignedFree(ptr);</div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00046">46</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="a3eaff15957792b4bf4adf0dad3838d42" name="a3eaff15957792b4bf4adf0dad3838d42"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3eaff15957792b4bf4adf0dad3838d42">&#9670;&#160;</a></span>alignToCacheLine()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t dispenso::alignToCacheLine </td>
          <td>(</td>
          <td class="paramtype">uintptr_t</td>          <td class="paramname"><span class="paramname"><em>val</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Align a value up to the next cache line boundary. </p>
<p>Rounds up the input value to the next multiple of kCacheLineSize. Useful for manual memory layout to avoid false sharing.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">val</td><td>The value to align </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Value aligned to next cache line boundary</dd></dl>
<dl class="section see"><dt>See also</dt><dd>kCacheLineSize</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="keywordtype">size_t</span> offset = dispenso::alignToCacheLine(37);  <span class="comment">// Returns 64</span></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00111">111</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="ad1e2ca26986584ede0179073a455ab95" name="ad1e2ca26986584ede0179073a455ab95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad1e2ca26986584ede0179073a455ab95">&#9670;&#160;</a></span>cpuRelax()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void dispenso::cpuRelax </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>CPU relaxation hint for spin loops. </p>
<p>Emits a platform-specific instruction (PAUSE on x86, YIELD on ARM) to improve spin loop performance and reduce power consumption. Use this in busy-wait loops to be friendlier to hyper-threading and the CPU pipeline.</p>
<dl class="section note"><dt>Note</dt><dd>This is a no-op on platforms without a specific relax instruction</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="keywordflow">while</span> (!flag.load(std::memory_order_acquire)) {</div>
<div class="line">  dispenso::cpuRelax();  <span class="comment">// Be nice to the CPU</span></div>
<div class="line">}</div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00131">131</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="af136448e8dfb75d4ffa0a89ef5ae686f" name="af136448e8dfb75d4ffa0a89ef5ae686f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af136448e8dfb75d4ffa0a89ef5ae686f">&#9670;&#160;</a></span>log2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dispenso::log2 </td>
          <td>(</td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute log base 2 of a value (runtime). </p>
<p>Computes floor(log2(v)) using platform-specific intrinsics for optimal performance. On x86/x64, uses __builtin_clzll or __lzcnt64. Falls back to constexpr version on other platforms.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Input value (must be &gt; 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>floor(log2(v))</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Behavior is undefined if v is 0</dd></dl>
<p>Example: </p><div class="fragment"><div class="line">uint32_t power = dispenso::log2(size);  <span class="comment">// Fast bit scan</span></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00193">193</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="af014fb9ca7d4021c6cca0e7fa545dafd" name="af014fb9ca7d4021c6cca0e7fa545dafd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af014fb9ca7d4021c6cca0e7fa545dafd">&#9670;&#160;</a></span>log2const()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t dispenso::log2const </td>
          <td>(</td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute log base 2 of a value (compile-time). </p>
<p>Computes floor(log2(v)) at compile time. Useful for template metaprogramming and constexpr contexts.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Input value (must be &gt; 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>floor(log2(v))</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Behavior is undefined if v is 0</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">static_assert</span>(dispenso::log2const(64) == 6);</div>
<div class="line"><span class="keyword">static_assert</span>(dispenso::log2const(100) == 6);</div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00172">172</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="afc7b3cf111878cc7339480bb02b6e801" name="afc7b3cf111878cc7339480bb02b6e801"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc7b3cf111878cc7339480bb02b6e801">&#9670;&#160;</a></span>nextPow2()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t dispenso::nextPow2 </td>
          <td>(</td>
          <td class="paramtype">uint64_t</td>          <td class="paramname"><span class="paramname"><em>v</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Round up to the next power of 2. </p>
<p>Computes the smallest power of 2 that is greater than or equal to the input value.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td>Input value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Next power of 2 (or v if v is already a power of 2)</dd></dl>
<dl class="section note"><dt>Note</dt><dd>Returns 0 if v is 0</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">static_assert</span>(dispenso::nextPow2(17) == 32);</div>
<div class="line"><span class="keyword">static_assert</span>(dispenso::nextPow2(64) == 64);</div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00151">151</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
<a id="afeee067e0bcb4e306c1ed27fc95b5f21" name="afeee067e0bcb4e306c1ed27fc95b5f21"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afeee067e0bcb4e306c1ed27fc95b5f21">&#9670;&#160;</a></span>staticChunkSize()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">StaticChunking dispenso::staticChunkSize </td>
          <td>(</td>
          <td class="paramtype">ssize_t</td>          <td class="paramname"><span class="paramname"><em>items</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ssize_t</td>          <td class="paramname"><span class="paramname"><em>chunks</em></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Compute optimal static chunking for load balancing. </p>
<p>Divides items into chunks such that the work is distributed as evenly as possible. Returns chunking info where some tasks get ceil(items/chunks) and others get floor(items/chunks).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">items</td><td>Total number of items to process </td></tr>
    <tr><td class="paramname">chunks</td><td>Number of chunks to divide into (must be &gt; 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>StaticChunking information for distributing the work</dd></dl>
<p>Example: </p><div class="fragment"><div class="line"><span class="keyword">auto</span> chunking = dispenso::staticChunkSize(100, 8);</div>
<div class="line"><span class="comment">// First 4 threads get 13 items each, last 4 get 12 items each</span></div>
<div class="line"><span class="comment">// 4*13 + 4*12 = 52 + 48 = 100</span></div>
</div><!-- fragment --> 
<p class="definition">Definition at line <a class="el" href="util_8h_source.html#l00284">284</a> of file <a class="el" href="util_8h_source.html">util.h</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_ff109a5d4b8a833924ba8452f0ad7d5d.html">dispenso</a></li><li class="navelem"><a class="el" href="util_8h.html">util.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
